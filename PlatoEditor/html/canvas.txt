<html>
<head>
<title>Canvas Demo</title>
<head>
<body>
<!-- http://jsfiddle.net/f0yancvw/1/ -->
<canvas>
<canvas id="canvas" height="500" width="500"></canvas>
</canvas>
</body>
<script>

{{getColorDefinition}}

var canvas = document.getElementById('canvas');
var canvasWidth  = canvas.width;
var canvasHeight = canvas.height;
var ctx = canvas.getContext('2d');
var imageData = ctx.getImageData(0, 0, canvasWidth, canvasHeight);

var buf = new ArrayBuffer(imageData.data.length);
var buf8 = new Uint8ClampedArray(buf);
var data = new Uint32Array(buf);

// https://hacks.mozilla.org/2011/12/faster-canvas-pixel-manipulation-with-typed-arrays/
// NOTE: Endianess bug.
for (var y = 0; y < canvasHeight; ++y) {
    for (var x = 0; x < canvasWidth; ++x) {

        var value = getColor(x / canvasWidth, y / canvasHeight);

        data[y * canvasWidth + x] =
            (255   << 24) |    // alpha
            (value << 16) |    // blue
            (value <<  8) |    // green
             value;            // red
    }
}

imageData.data.set(buf8);

ctx.putImageData(imageData, 0, 0);
</script>
</html>